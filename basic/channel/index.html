<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Go는 동시성에 특화된 언어적 특성을 가지고 있다. 전통적인 방식의 언어에서는 그린 스레드(또는 OS 레벨의 스레드)를 만들고 공유 변수와 메모리 락을 통해 동시성을 제어하는 편이다. Go는 고루틴을 사용하고 이는 그린 스레드 개념보다 훨씬 가볍고 작다. 단순히 함수의 흐름(continuation이라고 표현한다)을 호스팅 하는 역할을 한다. 내부적으로 GOMAXPROCS 변수의 크기만큼 OS 레벨의 스레드를 만들고 그 수 만큼 논리 프로세서를 만들어 이 고루틴을 멀티플랙싱 하는 방식이다. 관련된 내용은 스케줄러 파트에서 자세히 다룬다. 어쨌든 Go는 이렇게 동시 실행되는(정확히는 순서를 알 수 없는) 고루틴을 동기화 하기 위해서 위에서 언급한 &ldquo;전통적인 방식&#34;을 제공하지만, 채널이라는 특수한 연결 고리 역시 제공하고 있다.">
<meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Channel">
<meta property="og:description" content="Go는 동시성에 특화된 언어적 특성을 가지고 있다. 전통적인 방식의 언어에서는 그린 스레드(또는 OS 레벨의 스레드)를 만들고 공유 변수와 메모리 락을 통해 동시성을 제어하는 편이다. Go는 고루틴을 사용하고 이는 그린 스레드 개념보다 훨씬 가볍고 작다. 단순히 함수의 흐름(continuation이라고 표현한다)을 호스팅 하는 역할을 한다. 내부적으로 GOMAXPROCS 변수의 크기만큼 OS 레벨의 스레드를 만들고 그 수 만큼 논리 프로세서를 만들어 이 고루틴을 멀티플랙싱 하는 방식이다. 관련된 내용은 스케줄러 파트에서 자세히 다룬다. 어쨌든 Go는 이렇게 동시 실행되는(정확히는 순서를 알 수 없는) 고루틴을 동기화 하기 위해서 위에서 언급한 &ldquo;전통적인 방식&#34;을 제공하지만, 채널이라는 특수한 연결 고리 역시 제공하고 있다.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://changhoi.github.io/dive-into-go/basic/channel/"><meta property="article:section" content="basic">
<meta property="article:modified_time" content="2021-11-04T14:44:51+09:00">
<title>Channel | Dive into Go</title>
<link rel=manifest href=/dive-into-go/manifest.json>
<link rel=icon href=/dive-into-go/favicon.png type=image/x-icon>
<link rel=stylesheet href=/dive-into-go/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous>
<script defer src=/dive-into-go/flexsearch.min.js></script>
<script defer src=/dive-into-go/en.search.min.f6183b1ffcb358fc4205a35e1fb11c575851f90e39ec556caacf3b7889fe84ec.js integrity="sha256-9hg7H/yzWPxCBaNeH7EcV1hR+Q457FVsqs87eIn+hOw=" crossorigin=anonymous></script>
<script defer src=/dive-into-go/sw.min.60b3febe1cfe2ef0ba434075e748989e1c1847ee656e8cd2cc6afbfa3b335093.js integrity="sha256-YLP+vhz+LvC6Q0B150iYnhwYR+5lbozSzGr7+jszUJM=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-149480446-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/dive-into-go/><img src=/dive-into-go/logo.png alt=Logo><span>Dive into Go</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<p>
<a href=/dive-into-go/basic/>Basic</a></p>
<ul>
<li>
<a href=/dive-into-go/basic/channel/ class=active>Channel</a></li>
<li>
<a href=/dive-into-go/basic/package/>Package</a></li>
<li>
<a href=/dive-into-go/basic/module/>Module</a></li>
</ul>
</li>
<li>
<p>
<a href=/dive-into-go/insides/>Insides</a></p>
</li>
<li>
<p>
<a href=/dive-into-go/libraries/>Libraries</a></p>
<ul>
<li>
<a href=/dive-into-go/libraries/log/>log</a></li>
<li>
<a href=/dive-into-go/libraries/context/>context</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<a href=https://github.com/changhoi/dive-into-go target=_blank rel=noopener>
Github
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/dive-into-go/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Channel</strong>
<label for=toc-control>
<img src=/dive-into-go/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#채널>채널</a>
<ul>
<li><a href=#생성과-채널-타입>생성과 채널 타입</a>
<ul>
<li><a href=#수신-타입-송신-타입>수신 타입, 송신 타입</a></li>
<li><a href=#버퍼>버퍼</a></li>
</ul>
</li>
<li><a href=#송신>송신</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><p>Go는 동시성에 특화된 언어적 특성을 가지고 있다. 전통적인 방식의 언어에서는 그린 스레드(또는 OS 레벨의 스레드)를 만들고 공유 변수와 메모리 락을 통해 동시성을 제어하는 편이다. Go는 고루틴을 사용하고 이는 그린 스레드 개념보다 훨씬 가볍고 작다. 단순히 함수의 흐름(continuation이라고 표현한다)을 호스팅 하는 역할을 한다. 내부적으로 <code>GOMAXPROCS</code> 변수의 크기만큼 OS 레벨의 스레드를 만들고 그 수 만큼 논리 프로세서를 만들어 이 고루틴을 멀티플랙싱 하는 방식이다. 관련된 내용은 스케줄러 파트에서 자세히 다룬다. 어쨌든 Go는 이렇게 동시 실행되는(정확히는 순서를 알 수 없는) 고루틴을 동기화 하기 위해서 위에서 언급한 &ldquo;전통적인 방식"을 제공하지만, 채널이라는 특수한 연결 고리 역시 제공하고 있다. 채널을 공유해서 데이터 흐름을 강제할 수 있다.</p>
<h1 id=채널>
채널
<a class=anchor href=#%ec%b1%84%eb%84%90>#</a>
</h1>
<p>고루틴은 Go 프로그램의 동작이라고 볼 수 있고, 채널은 고루틴 간의 연결이다. 한 고루틴에서 다른 고루틴으로 값을 보내기 위한 통신 메커니즘이다.</p>
<h2 id=생성과-채널-타입>
생성과 채널 타입
<a class=anchor href=#%ec%83%9d%ec%84%b1%ea%b3%bc-%ec%b1%84%eb%84%90-%ed%83%80%ec%9e%85>#</a>
</h2>
<p><code>make</code> 내장 함수를 통해 만들 수 있다. 예를 들어서 아래 코드는 <code>int</code> 자료형을 주고 받는 통로 역할을 하는 채널을 만들어준다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</code></pre></div><p><code>ch</code>는 맵 자료 구조처럼, <code>make</code>로 인해 만들어진 데이터 구조에 대한 참조이다. 채널을 복사하거나, 함수의 인자로 전달할 때는 참조를 통해 복사하기 때문에 복사된 값은 같은 데이터 구조를 참조하게 된다. 다른 참조 타입들과 마찬가지로 <code>nil</code>값을 제로값으로 갖게 된다. 같은 타입인 채널은 비교 연산으로 비교가 가능하다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>c1</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
<span style=color:#a6e22e>c2</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
<span style=color:#a6e22e>c3</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>string</span>)

<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>c1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>c2</span>) <span style=color:#75715e>// false, 타입은 같기 때문에 비교 연산은 가능한데, 같은 채널이 아님
</span><span style=color:#75715e></span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>c3</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>c2</span>) <span style=color:#75715e>// 컴파일 에러, 타입이 다름
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nilChan1</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>nilChan2</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>

<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>nilChan1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>nilChan2</span>) <span style=color:#75715e>// true, 타입도 같은데 둘 다 nil값으로 같음
</span></code></pre></div><hr>
<h3 id=수신-타입-송신-타입>
수신 타입, 송신 타입
<a class=anchor href=#%ec%88%98%ec%8b%a0-%ed%83%80%ec%9e%85-%ec%86%a1%ec%8b%a0-%ed%83%80%ec%9e%85>#</a>
</h3>
<p>채널은 데이터를 주고 받는 역할을 한다고 했다. 송신 구문은 하나의 고루틴에서 채널을 통해 그 채널의 수신 표현식이 있는 다른 고루틴으로 값을 전달한다. 송신과 수신 모두 <code>&lt;-</code> 연산을 사용하는데, 붙는 위치에서 차이가 발생한다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>x</span> <span style=color:#75715e>// 송신
</span><span style=color:#75715e></span><span style=color:#a6e22e>y</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span> <span style=color:#75715e>// 수신
</span></code></pre></div><p>송신하는 역할을 하는 채널과 수신하는 역할을 하는 채널은 다른 타입으로 분류가 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c1</span> <span style=color:#66d9ef>chan</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>int</span> <span style=color:#75715e>// 송신용 채널 타입
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c2</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span> <span style=color:#75715e>// 수신용 채널 타입
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>c1</span> = <span style=color:#a6e22e>c</span>
<span style=color:#a6e22e>c2</span> = <span style=color:#a6e22e>c</span>

<span style=color:#75715e>// c1 != c2 둘 비교는 컴파일 에러를 발생시킨다. (mismatched types)
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>c1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>c</span>) <span style=color:#75715e>// true,
</span><span style=color:#75715e></span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>c2</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>c</span>) <span style=color:#75715e>// true, 양방향 모두 가능한 채널은 각 타입으로 암묵적인 변환이 가능하다.
</span></code></pre></div><p>송신 전용 채널에서 수신을 하려 한다든지, 수신 전용 채널에서 송신을 하려 하면 컴파일 에러(invalid operation)를 발생시킨다. 이 특징을 사용해서 함수 내에서 기능을 제한하는 용도로 사용해 더 안전하게 프로그램을 작성할 수 있다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>writer</span>(<span style=color:#a6e22e>out</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>results</span> []<span style=color:#66d9ef>int</span>
    <span style=color:#75715e>// ... 
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>results</span> {
        <span style=color:#a6e22e>out</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>data</span>
    }
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
    <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>writer</span>(<span style=color:#a6e22e>ch</span>)
}
</code></pre></div><blockquote>
<p>한 번 구체적인 용도가 정해진 채널을 다시 바꿀 수는 없다.</p>
</blockquote>
<hr>
<h3 id=버퍼>
버퍼
<a class=anchor href=#%eb%b2%84%ed%8d%bc>#</a>
</h3>
<p>채널은 버퍼가 있는 채널과 없는 채널로 나눠진다. 버퍼를 설정하기 위해서는 <code>make</code> 내장 함수의 두 번째 인자값으로 음이 아닌 정수를 넣어주면 된다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>c1</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) <span style=color:#75715e>// make(chan int, 0)과 같다.
</span><span style=color:#75715e></span><span style=color:#a6e22e>c2</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>2</span>) <span style=color:#75715e>// 버퍼가 2인 채널
</span></code></pre></div><p>버퍼</p>
<h2 id=송신>
송신
<a class=anchor href=#%ec%86%a1%ec%8b%a0>#</a>
</h2>
<p>송신은 위에서 언급한 타입대로</p>
<p>채널을 닫기 위해서는 <code>close</code> 내장 함수를 사용한다. <code>close</code>를 사용해 송신 가능한 채널을 닫으면, 더 이상 값을 보내지 않음을 나타내는 플래그를 설정한다. <strong>이후 송신을 시도하면 패닉이 발생한다.</strong> 그리고, 만약 <strong>닫혀있는 채널을 다시 닫으려고 하면 마찬가지로 패닉이 발생된다.</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>panic: close of closed channel <span style=color:#75715e># 닫힌 채널을 다시 닫으려고 할 때</span>
panic: send on closed channel <span style=color:#75715e># 닫힌 채널에 데이터를 송신하려고 할 때</span>
</code></pre></div></article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/changhoi/dive-into-go/commit/3a4832de8037226aee70cb4d3868fd325833d723 title="Last modified by changhoi | November 4, 2021" target=_blank rel=noopener>
<img src=/dive-into-go/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 4, 2021</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#채널>채널</a>
<ul>
<li><a href=#생성과-채널-타입>생성과 채널 타입</a>
<ul>
<li><a href=#수신-타입-송신-타입>수신 타입, 송신 타입</a></li>
<li><a href=#버퍼>버퍼</a></li>
</ul>
</li>
<li><a href=#송신>송신</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>